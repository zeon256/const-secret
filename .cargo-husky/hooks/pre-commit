#!/bin/bash
# Pre-commit hook for const-secret
# Runs fast checks before every commit

set -e

echo "üîç Running pre-commit checks..."

# Track failures
FAILED=0

# Run format check
echo "  ‚Üí Checking formatting..."
if ! cargo fmt --all -- --check 2>&1; then
    echo "    ‚úó Formatting failed. Run 'cargo fmt --all' to fix."
    FAILED=1
else
    echo "    ‚úì Formatting OK"
fi

# Run clippy
echo "  ‚Üí Running Clippy..."
if ! cargo clippy -- -D warnings 2>&1; then
    echo "    ‚úó Clippy warnings found."
    FAILED=1
else
    echo "    ‚úì Clippy OK"
fi

# Run tests
echo "  ‚Üí Running tests..."
if ! cargo test 2>&1; then
    echo "    ‚úó Tests failed."
    FAILED=1
else
    echo "    ‚úì Tests OK"
fi

if [ $FAILED -eq 0 ]; then
    echo ""
    echo "‚úÖ All pre-commit checks passed!"
    exit 0
else
    echo ""
    echo "‚ùå Pre-commit checks failed. Fix errors above before committing."
    exit 1
fi
